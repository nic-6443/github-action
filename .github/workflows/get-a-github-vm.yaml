name: Get A GITHUB VM
on:
  watch:
    types: [started]
jobs:
  build:
    runs-on: ubuntu-latest
    if: github.actor == github.event.repository.owner.login
    steps:
      - name: Setup ssh
        env:
          KEY: ${{ secrets.KEY }}
        run: |
          echo $KEY > /tmp/ssh.key
          chmod 600 /tmp/ssh.key
      - name: Slack Notification
        uses: rtCamp/action-slack-notify@v2
        env:
          SLACK_WEBHOOK: ${{ secrets.SLACK_WEB_HOOK }}
          SLACK_TITLE: Get A GITHUB VM
          SLACK_MESSAGE: ${{ github.server_url }}/${{ github.repository }}/actions/runs/${{ github.run_id }}
      - name: Tmate
        env:
          GIT_SSH_COMMAND: "ssh -i /tmp/ssh.key" 
        uses: mxschmitt/action-tmate@v3
        with:
          limit-access-to-actor: true